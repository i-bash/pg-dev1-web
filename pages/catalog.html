<h3>Catalog</h3>

<div id="catalog" class="list-group">
	<div class="list-group-item clearfix">
		<span class="col-sm-1">#</span>
		<span class="col-sm-7">Name</span>
		<span class="col-sm-1 text-right">Qty</span>
		<span class="col-sm-3">Order</span>
	</div>
</div>
<script>
	//functions
	var populateCatalog=()=>{
		lib.server(
			'getCatalog',
			[],
			data=>{
				let table=$('#catalog');
				$(table).children('div:gt(0)').remove();
				data.forEach(
					r=>{
						let row=$('<div/>',{class:'list-group-item clearfix'})
							.append($('<span/>',{class:'col-sm-1'}).html(r.book_id))
							.append($('<span/>',{class:'col-sm-7'}).html(r.display_name))
						;
						if(r.onhand_qty!==undefined){
							row
								.append($('<span/>',{class:'text-right col-sm-1'}).html(r.onhand_qty))
								.append(
									$('<span/>',{class:'col-sm-3'})
									.append(
										$('<form/>',{class:'form-inline order',action:'orderBook',method:'post'})
										.append($('<input/>',{name:'qty',type:'number',min:'1',step:'1',placeholder:'Qty',class:'form-control txt-right'}))
										.append($('<input/>',{name:'id',type:'hidden',value:r.book_id}))
										.append($('<button/>',{type:'submit',class:'btn btn-success disabled'}).html('Order'))
									)
								)
							;
						}
						else{
							row.append($('<span/>',{class:'col-sm-5'}));
						}
						row.appendTo(table);
					}
				);
			}
		);
	};
	var isIntegerString=s=>{
		let integer=Number.parseInt(s);
		return integer.toString()!==s||integer<=0;
	}
	var chkSubmit=event=>{
		let disabled=isIntegerString($(event.currentTarget).val());
		$(event.currentTarget).siblings('button').toggleClass('disabled',disabled).prop('disabled',disabled);
	}
	//forms
	lib.ajaxForm(
		'.order',
		()=>{
			lib.alert('You have ordered the book(s)');
			populateCatalog();
		}
	);
	//events
	$('#catalog').on(
		'input change',
		'input[name="qty"]',
		chkSubmit
	);
	//init
	lib.clearSql();
	populateCatalog();
</script>
