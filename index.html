<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="lib/bootstrap-3.3.7-dist/css/bootstrap.min.css"/>
		<link rel="stylesheet" href="main.css"/>
		<script src="lib/jquery-3.1.1.min.js"></script>
		<script src="lib/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
		<script src="main.js"></script>
	</head>
	<body>
		<div class="container">
			<h2>DEV1 web application</h2>
			<div id="main" class="row">
				<div class="col-md-8">
					<h4>Application</h4>
					<div class="btn-toolbar" role="toolbar">
						<div class="btn-group" role="group">
							<button type="button" class="btn btn-info" data-page="shop">Shop</button>
						</div>
						<div class="btn-group pull-right" role="group">
							<button type="button" class="btn btn-info" data-page="authors">Authors</button>
							<button type="button" class="btn btn-info" data-page="books">Books</button>
							<button type="button" class="btn btn-info" data-page="catalog">Catalog</button>
						</div>
					</div>
					<div id="page"></div>
					<div id="alert"></div>
				</div>
				<div class="col-md-4">
					<h4>Database</h4>
					<div id="db2" class="row form-group">
						<div class="col-md-9 col-sm-10">
							<label for="role">DB role</label><select id="role" class="form-control"></select>
						</div>
						<div class="col-md-3 col-sm-2">
							<div id="loader" class="pull-right"></div>
						</div>
					</div>
					<div><p id="error" class="alert alert-danger"></p></div>
					<div><p id="success" class="alert alert-success">OK</p></div>
					<div><p id="sql" class="alert alert-info"></p></div>
				</div>
			</div>
		</div>
		<script>
			$(
				()=>{
					//select role
					$('#role').change((e)=>{
						lib.server(
							'setRole',
							{'role':$(e.target).val()},
							()=>{
								lib.displayPage($('.btn[data-page].btn-primary').data('page'));
							}
						);
					});
					//display page
					$('.btn[data-page]').click(
						e=>{
							$('.btn[data-page]').not(e.target).removeClass('btn-primary').addClass('btn-info');
							$(e.target).removeClass('btn-info').addClass('btn-primary');
							lib.displayPage($(e.target).data('page'));
						}
					);
					//fill in roles
					lib.server(
						'getRoles',
						{},
						data=>{
							let select=$('#role');
							data.forEach(r=>{
								$('<option/>').val(r).html(r).appendTo(select);
							});
							$('#role').trigger('change');
						}
					);
				}
			);
		</script>
	</body>
</html>